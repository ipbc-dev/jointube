image: framasoft/vuefs:latest
stages:
  - deploy

pages:
  stage: deploy
  script:
  - yarn install --pure-lockfile
  - npm run build
  artifacts:
    paths:
    - dist
  cache:
    paths:
      - node_modules/

#production:
  #stage: deploy
  #script:
  #- npm install
  #- npm run prod
  #- cp ./public/fr/index.html ./public/index.html
  #- for f in $(find -type l);do cp --remove-destination $(readlink -f $f) $f;done;
  #- mkdir "${HOME}/.ssh"
  #- chmod 700 "${HOME}/.ssh"
  #- if [ ! -z ${DEPLOYEMENT_KNOWN_HOSTS+x} ]; then echo -e "${DEPLOYEMENT_KNOWN_HOSTS}" > ${HOME}/.ssh/known_hosts; fi
  #- eval `ssh-agent -s`
  #- if [ ! -z ${DEPLOYEMENT_KEY+x} ]; then ssh-add <(echo "${DEPLOYEMENT_KEY}" | base64 --decode -i); fi
  #- if [ ! -z ${DEPLOYEMENT_KEY+x} ]; then cd public && echo "put -r ." | sftp ${DEPLOYEMENT_USER}@${DEPLOYEMENT_HOST}:../../web; fi
  #only:
    #- master
